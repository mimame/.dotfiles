# prek Configuration: A fast pre-commit hook manager written in Rust.
# This file defines the hooks that run before each commit to ensure code quality and security.

repos:
  # Built-in hooks provided natively by prek.
  # These are optimized for speed as they are implemented directly in the prek framework.
  - repo: builtin
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-added-large-files
      - id: detect-private-key
      # FIXME: The following built-in hooks are supported in prek 0.2.24 (Homebrew)
      # but are missing in 0.2.20 (NixOS unstable).
      # - id: check-case-conflict
      # - id: check-executables-have-shebangs

  # External hooks
  - repo: https://github.com/alessandrojcm/commitlint-pre-commit-hook
    rev: v9.23.0
    hooks:
      - id: commitlint
        stages: [commit-msg]

  # Local hooks targeting system-installed tools.
  # These hooks run specific binaries available in the environment (e.g., via shell.nix).
  - repo: local
    hooks:
      # Unified formatter pass using treefmt.
      - id: treefmt
        name: treefmt
        language: system
        entry: treefmt
        pass_filenames: false

      # GitHub Actions workflow linter.
      - id: actionlint
        name: actionlint
        language: system
        entry: actionlint
        files: ^\.github/workflows/

      # Ruby linter and formatter. Optimized with --server for local execution.
      - id: rubocop
        name: rubocop
        language: system
        entry: rubocop
        files: \.rb$

      # Fast secret scanning for generic high-entropy strings.
      - id: ripsecrets
        name: ripsecrets
        language: system
        entry: ripsecrets

      # Comprehensive secret scanning with service-specific rules.
      # Optimized to only scan staged changes for performance.
      - id: gitleaks
        name: gitleaks
        language: system
        entry: gitleaks protect --staged --verbose --redact
        pass_filenames: false
